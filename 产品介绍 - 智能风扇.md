智能风扇介绍

1应用场景

​	随着科学技术的创新，和人们消费需求的提高，传统的风扇逐渐被空调所取代。然而，由于智能电风扇的便携性和价格低廉，智能电风扇在可预见的未来仍有价值。针对传统风扇转速单一、无法实现人体感知和自动启停的问题，智能电风扇设计了完善的智能自动控制系统，以改善传统风扇的这些不足。智能电风扇采用移动应用程序控制，而不是传统的手动方式，智能电风扇可以极大方便人们的生活起居。不仅如此，智能风扇还可代替传统风扇，应用于无需长时间工作的场所，例如客车发动机，笔记本内部，仅在其高载荷运行时启动，能够大大降低能耗，提高能量利用率。

2实现功能

​	该智能风扇有两种模式，一是自动模式，该模式下，风扇会实时监测环境温度，当环境温度大于一定的值时，风扇开启最大档位进行降温，二是手动模式，当用户按下云端应用中的手动模式开关后会切换至手动模式，该模式下初始档位为0，即风扇关闭，当用户按下应用中的改变档位按钮后，风扇档位加一，转速加快。该风扇共有三挡，当档位置于最大后，用户按下改变档位按钮，则风扇档位会重置至为0。此外，该智能风扇能将环境温度、运行模式、风扇状态、风扇档位显示在OLED屏上，并且将这些数据上传至云端。云端应用中包含了环境温度、风扇档位的变化图以及运行模式、风扇状态的显示，同时应用中还有手动模式开关和改变档位按钮用于对智能风扇下达命令。

2系统硬件设计

​	该设计选用的核心控制芯片是基于Cortex-M3内核的APM32F103ZET6，它是一款高性能、高兼容、易开发、低功耗、低工作电压以及具有实时数字信号处理的32位闪存微控制器产品。智能风扇系统是由单片机、温度传感器模块、ESP8266WIFI模块等组成，系统的结构图如下图所示：

![系统结构图](D:\Intelligent Fan\picture\系统结构图.png)

2.1aht10温湿度传感器

​	AHT10嵌入了适于回流焊的双列扁华无引脚SMD封装，底面4x5mm高度1.6mm。传感器输出经过标定的数字信号，标准IC格式。
​	AHT10配有一个全新设计的ASIC专用芯片，一个经过改进的MEMS半导体电容式湿度传感元件和一个标准的片上温度传感元件，其性能已经大大提升甚至超出了前一代传感器的可靠性水平，新一代温湿度传感器，经过改进使其在恶劣环境下的性能更稳定。

2.2OLED显示屏

​	屏幕选用的是4针0.96寸OLED屏幕，这是一种新型的屏幕技术，拥有自发光的特性，具有可视角度大、功耗低、对比度高等优势。对比lcd屏屏幕，OLED显示效果更好、功耗更低、适合小系统。OLED屏幕可以根据需要显示出字符、数字、汉字等，使用起来简单方便。

2.3ESP8266WIFI模块

​	ESP8266是一款超低功耗的UART-WiFi 透传模块，拥有业内极富竞争力的封装尺寸和超低能耗技术，专为移动设备和物联网应用设计，可将用户的物理设备连接到Wi-Fi 无线网络上，进行互联网或局域 网通信，实现联网功能。 ESP8266封装方式多样，天线可支持板载PCB天线，IPEX接口和邮票孔接口三种形式； ESP8266可广泛应用于智能电网、智能交通、智能家具、手持设备、工业控制等领域。

2.4L2985N直流电机驱动模块

​	L298N是意法半导体集团旗下量产的一种电机驱动芯片，拥有工作电压高、输出电流大、驱动能力强、发热量低、抗干扰能力强等特点，通常用来驱动继电器、螺线管、电磁阀、直流电机以及步进电机。

3系统软件设计

3.1主程序设计

​		风扇系统的程序设计使用的是C语言编程，实现温度读取，电机控制，oled显示等，风扇有手动模式和自动模式两种模式。系统的程序流程图如下图所示：

![软硬件架构图](D:\Intelligent Fan\picture\软硬件架构图.png)

3.2电机驱动程序设计

​	电机设置由定时器TIM3产生的 PWM 波控制，首先利用rt_device_find（const char * name）函数通过指定的名称查找设备，再利用rt_pwm_set  ( struct rt_device_pwm *  device,  int  channel,  rt_uint32_t  period,  rt_uint32_t  pulse  ) 设置PWM参数，最后用rt_pwm_enable  ( struct rt_device_pwm *  device,   int  channel  )使能设备。

3.3自动模式程序设计

​	自动模式下风扇的开启与否是根据温度传感器检测到的周围温度变化而决定，传感器检测到周围温度高于 28℃时，风扇开始工作。温度的读取程序中，首先使用rt_hw_aht10_port(void)初始化 aht10,线程2通过aht10_read_temperature（）不断读取温度，并通过消息队列将温度发送到线程1中，线程1根据温度判断是否开启风扇，最后将温度，运行模式，风扇状态，风扇档位发送至云端。

3.4手动模式程序设计

​	mqtt线程检测是否收到命令，如果收到命令o，则发送事件1至线程1，线程1切换风扇状态量，将风扇改为手动模式，如果mqtt线程收到命令v，则发送事件2至线程1，风扇转速提高一个档位，如果已达到最大档位，则将风扇关闭，最后将温度，运行模式，风扇状态，风扇档位发送至云端。

4系统测试

4.1自动模式测试

​	风扇切换成自动模式，当温度低于28°C时，风扇不转动，OLED屏幕显示周围温度为26℃，运行模式为手动，风扇关闭，档位为0。云端数据和实物图如图所示：

![auto 26](D:\Intelligent Fan\picture\auto 26.png)

![auto26](D:\rrt\summer2022\luhaoqi\智能风扇\picture\auto26.jpg)

​	用手将温度传感器捂热，OLED 屏幕显示的温度数值逐渐升高，当温度到达28℃，风扇开启转动，档位为3。云端数据和实物图如图所示：

![auto 28](D:\Intelligent Fan\picture\auto 28.png)

![auto28](D:\rrt\summer2022\luhaoqi\智能风扇\picture\auto28.jpg)



4.2手动模式测试

​	云端开启手动模式开关时，运行模式切换为手动模式，，此时风扇关闭，档位为0。

![manu level0](D:\Intelligent Fan\picture\manu level0.jpg)

![manulevel0](D:\Intelligent Fan\picture\manulevel0.jpg)

按下改变档位按钮，风扇档位增加，风扇开始转动，档位为1。

![manu level1](D:\Intelligent Fan\picture\manu level1.jpg)

![manulevel1](D:\Intelligent Fan\picture\manulevel1.jpg)

再次按下改变档位按钮，风扇档位增加，档位为2。

![manu level2](D:\Intelligent Fan\picture\manu level2.jpg)

![manulevel2](D:\Intelligent Fan\picture\manulevel2.jpg)

再次按下改变档位按钮，风扇档位增加，档位为3。

![manu level3](D:\Intelligent Fan\picture\manu level3.jpg)

![manulevel3](D:\Intelligent Fan\picture\manulevel3.jpg)